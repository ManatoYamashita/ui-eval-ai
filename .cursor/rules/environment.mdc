---
<<<<<<< HEAD
alwaysApply: false
---

# environment.mdc

## 開発環境設定ルール

### 基本技術スタック
- **Node.js**: v18以上を使用
- **Package Manager**: npm を使用（yarnやpnpmは避ける）
- **OS**: MacBook Pro (14インチ, M3, Nov 2023, OS: 15.5) をベースとする

### 環境変数管理
- APIキー、データベース接続情報、その他の機密データは**すべて環境変数を通じて管理**
- 決してコードベースに直接ハードコードしない
- `.env.local.example` ファイルを作成してテンプレートを提供

### 依存関係管理
- `package.json` のバージョン指定は適切なセマンティックバージョニングを使用
- 不要な依存関係は定期的に削除
- セキュリティ脆弱性は `npm audit` で定期確認

## Google Cloud Console API設定

### 基本設定手順
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 正しいプロジェクトが選択されていることを確認
3. **APIs & Services** → **Credentials** で APIキーを管理

### APIキー設定のベストプラクティス

#### 開発環境での推奨設定
**Application restrictions**: `None` を選択
- 開発時のエラー「API_KEY_HTTP_REFERRER_BLOCKED」を回避
- 設定変更は5-10分程度で反映

#### 本番環境での推奨設定
**Application restrictions**: `HTTP referrers (web sites)` を選択
```
# 本番環境設定例
https://your-domain.vercel.app/*
https://*.vercel.app/*
https://*-your-project.vercel.app/*
```

#### API制限の設定
**API restrictions**: `Restrict key` を選択
- `Generative Language API` のみ有効化
- 必要最小限のAPIのみ許可

### 環境変数設定
```bash
# 開発環境
GOOGLE_AI_API_KEY=development_key_with_localhost_restrictions

# 本番環境  
GOOGLE_AI_API_KEY=production_key_with_domain_restrictions
```

## API設定確認・テスト

### 設定確認方法
```bash
# APIキーのテスト
curl -X POST \
  'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "contents": [{
      "parts": [{"text": "Test message"}]
    }]
  }'
```

### トラブルシューティング

#### API_KEY_HTTP_REFERRER_BLOCKED エラー
**原因**: Google Cloud ConsoleでAPIキーに制限が設定されている
**解決策**:
1. Google Cloud Console → APIs & Services → Credentials
2. 該当APIキーの Application restrictions を `None` に変更
3. 5-10分待機後に再試行

#### プロジェクトでAPIが有効化されていない
**解決策**:
1. Google Cloud Console → APIs & Services → Library
2. "Generative Language API" を検索
3. "ENABLE" ボタンをクリック

### 正常動作時のログ例
```
🖼️ Starting Gemini image analysis...
📝 Prompt length: 525
🖼️ Image data size: 240476 characters
✅ Gemini analysis successful
🔍 Generating embedding for text: test button text layout...
✅ Embedding generated successfully
📚 Found 5 relevant guidelines
```

## セキュリティ・監視

### 使用量監視
- Google Cloud Console → APIs & Services → Quotas でアラート設定
- 異常な使用量増加の早期発見

### セキュリティ設定
- APIキーの定期的なローテーション
- 最小権限の原則に従ったAPI制限
- 本番環境では必ずドメイン制限を設定

## 参考リンク
- [Google AI API Documentation](https://ai.google.dev/docs)
- [API Key Best Practices](https://cloud.google.com/docs/authentication/api-keys)
- [Generative Language API](https://developers.generativeai.google/api)
# environment.mdc

## 開発環境設定ルール

### 基本技術スタック
- **Node.js**: v18以上を使用
- **Package Manager**: npm を使用（yarnやpnpmは避ける）
- **OS**: MacBook Pro (14インチ, M3, Nov 2023, OS: 15.5) をベースとする

### 環境変数管理
- APIキー、データベース接続情報、その他の機密データは**すべて環境変数を通じて管理**
- 決してコードベースに直接ハードコードしない
- `.env.local.example` ファイルを作成してテンプレートを提供

### 依存関係管理
- `package.json` のバージョン指定は適切なセマンティックバージョニングを使用
- 不要な依存関係は定期的に削除
- セキュリティ脆弱性は `npm audit` で定期確認

## Google Cloud Console API設定

### 基本設定手順
1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 正しいプロジェクトが選択されていることを確認
3. **APIs & Services** → **Credentials** で APIキーを管理

### APIキー設定のベストプラクティス

#### 開発環境での推奨設定
**Application restrictions**: `None` を選択
- 開発時のエラー「API_KEY_HTTP_REFERRER_BLOCKED」を回避
- 設定変更は5-10分程度で反映

#### 本番環境での推奨設定
**Application restrictions**: `HTTP referrers (web sites)` を選択
```
# 本番環境設定例
https://your-domain.vercel.app/*
https://*.vercel.app/*
https://*-your-project.vercel.app/*
```

#### API制限の設定
**API restrictions**: `Restrict key` を選択
- `Generative Language API` のみ有効化
- 必要最小限のAPIのみ許可

### 環境変数設定
```bash
# 開発環境
GOOGLE_AI_API_KEY=development_key_with_localhost_restrictions

# 本番環境  
GOOGLE_AI_API_KEY=production_key_with_domain_restrictions
```

## API設定確認・テスト

### 設定確認方法
```bash
# APIキーのテスト
curl -X POST \
  'https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "contents": [{
      "parts": [{"text": "Test message"}]
    }]
  }'
```

### トラブルシューティング

#### API_KEY_HTTP_REFERRER_BLOCKED エラー
**原因**: Google Cloud ConsoleでAPIキーに制限が設定されている
**解決策**:
1. Google Cloud Console → APIs & Services → Credentials
2. 該当APIキーの Application restrictions を `None` に変更
3. 5-10分待機後に再試行

#### プロジェクトでAPIが有効化されていない
**解決策**:
1. Google Cloud Console → APIs & Services → Library
2. "Generative Language API" を検索
3. "ENABLE" ボタンをクリック

### 正常動作時のログ例
```
🖼️ Starting Gemini image analysis...
📝 Prompt length: 525
🖼️ Image data size: 240476 characters
✅ Gemini analysis successful
🔍 Generating embedding for text: test button text layout...
✅ Embedding generated successfully
📚 Found 5 relevant guidelines
```

## セキュリティ・監視

### 使用量監視
- Google Cloud Console → APIs & Services → Quotas でアラート設定
- 異常な使用量増加の早期発見

### セキュリティ設定
- APIキーの定期的なローテーション
- 最小権限の原則に従ったAPI制限
- 本番環境では必ずドメイン制限を設定

## 参考リンク
- [Google AI API Documentation](https://ai.google.dev/docs)
- [API Key Best Practices](https://cloud.google.com/docs/authentication/api-keys)
- [Generative Language API](https://developers.generativeai.google/api)
=======
description: このファイルはプロジェクトの覚えておくべき環境変数について記述しています。
globs: 
alwaysApply: false
---
# environment.mdc

## 開発環境設定

### 基本開発環境
- **OS**: macOS 15.5 (Sonoma)
- **Hardware**: MacBook Pro (14インチ, M3, Nov 2023)
- **Node.js**: 最新のLTS版
- **Package Manager**: npm
- **IDE**: Cursor (VS Code + AI拡張)

### 必須開発ツール
- **TypeScript**: 厳密モード有効
- **ESLint**: コード品質チェック
- **Prettier**: コード整形
- **Tailwind CSS**: ユーティリティファーストCSS

## 環境変数管理

### 基本原則
- **APIキー、データベース接続情報、その他の機密データは、すべて環境変数を通じて管理し、決してコードベースに直接ハードコードしない**
- `.env.local`ファイルを使用してローカル開発環境の設定を管理
- 本番環境では、プラットフォーム固有の環境変数設定を使用

### 必須環境変数
```bash
# Supabase設定
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key

# AI API設定
OPENAI_API_KEY=your_openai_api_key
ANTHROPIC_API_KEY=your_anthropic_api_key

# Next.js設定
NEXTAUTH_URL=http://localhost:3000
NEXTAUTH_SECRET=your_nextauth_secret
```

### 環境変数の分類
- **NEXT_PUBLIC_**: クライアントサイドで使用可能な公開環境変数
- **サーバーサイド専用**: APIキーなどの機密情報

### セキュリティ対策
- `.env.local`ファイルは`.gitignore`に追加し、バージョン管理から除外
- サンプルファイル（`.env.example`）を作成し、必要な環境変数名のみを記載
- 定期的なAPIキーのローテーション

## データベース設定

### Supabase設定
- **データベース**: PostgreSQL with Vector Extension
- **認証**: Supabase Auth
- **ストレージ**: Supabase Storage（画像アップロード用）
- **検索機能**: ハイブリッド検索（pgvector + 全文検索）

### 接続設定
- Row Level Security (RLS) を有効化
- 適切なポリシー設定によるアクセス制御
- データベース移行スクリプトの管理

## 開発ワークフロー

### コード品質確保
- **静的解析ツール**: ESLint、Prettierを導入し、CI/CDパイプラインに組み込む
- **静的型チェック**: TypeScriptの厳密モードを常に有効
- **構造化ロギング**: デバッグ、監視、問題追跡のための適切なロギング実装

### 動作確認環境
- **ローカル開発**: `npm run dev`でNext.js開発サーバー起動
- **本番ビルド**: `npm run build`で本番環境向けビルド
- **静的解析**: `npm run lint`でコード品質チェック
>>>>>>> a763f6a90241b14dd4b33a79d6a595bb3b673828
